specVersion: 0.1.0
description: Demo WASM substreams

protoFiles:
  - /Users/eduardvoiculescu/git/streamingFast/substreams-template/proto/erc20.proto
  - /Users/eduardvoiculescu/git/streamingFast/substreams-template/proto/codec_eth.proto

modules:
  - name: block_to_hello_world
    kind: map
    startBlock: 14440000
    code:
      type: wasm/rust-v1
      file: ./target/wasm32-unknown-unknown/release/substreams_template.wasm
      entrypoint: map_hello_world
    inputs:
      - source: sf.ethereum.type.v1.Block
    output:
      type: proto:dfuse.ethereum.codec.v1.TransactionTrace

  - name: block_to_erc_20_transfer
    kind: map
    startBlock: 14440000
    code:
      type: wasm/rust-v1
      file: ./target/wasm32-unknown-unknown/release/substreams_template.wasm
      entrypoint: map_erc_20_transfer
    inputs:
      - source: sf.ethereum.type.v1.Block
    output:
      type: proto:eth.erc20.v1.Transfers

  - name: erc_20_transfer
    kind: store
    startBlock: 14440000
    updatePolicy: replace
    valueType: bytes
    code:
      type: wasm/rust-v1
      file: ./target/wasm32-unknown-unknown/release/substreams_template.wasm
      entrypoint: build_erc_20_transfer_state
    inputs:
      - map: block_to_erc_20_transfer

  - name: erc_20_transfers
    kind: map
    startBlock: 14440000
    code:
      type: wasm/rust-v1
      file: ./target/wasm32-unknown-unknown/release/substreams_template.wasm
      entrypoint: map_number_of_transfers_erc_20_transfer
    inputs:
      - map: block_to_erc_20_transfer
    output:
      type: proto:eth.counter.v1.Counter

  - name: created_contracts
    kind: map
    startBlock: 14440000
    code:
      type: wasm/rust-v1
      file: ./target/wasm32-unknown-unknown/release/substreams_template.wasm
      entrypoint: map_contract_creation
    inputs:
      - source: sf.ethereum.type.v1.Block
    output:
      type: proto:eth.contract.v1.Contracts
